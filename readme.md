# 单字符切割工具

这是一个基于 [PaddleOCR](https://github.com/PaddlePaddle/PaddleOCR) 和 OpenCV 的 Python 项目，旨在实现**文本检测后的单字符级别切割**。

项目包含完整的前端识别与后端字符切分逻辑，并附带了基于 PyInstaller 的自动化打包脚本，方便生成独立的可执行文件（exe）。



## 📂 项目结构

```text
.
├── main.py        # 核心代码：执行OCR识别、字符切割、绘图保存
├── package.py     # 打包脚本：将项目打包为exe，自动处理依赖
└── README.md      # 项目文档
```



## ✨ 核心功能

1. **文本检测**：利用 PaddleOCR (PP-OCRv5) 模型进行高精度的文本区域检测。
2. **智能单字符切割**：
   - **垂直投影法**：分析二值化图像的垂直投影，自动识别字符间的空白间隙进行切割。
   - **等宽兜底策略**：当投影法分割出的字符数与识别结果不一致时，自动回退到等宽均分策略，确保鲁棒性。
3. **可视化输出**：在原图上绘制每个字符的红色矩形框，并保存结果图片。
4. **一键打包**：提供 `package.py` 工具，支持包含 NVIDIA CUDA 依赖的打包选项。



## 🛠️ 环境依赖

参考[PaddleOCR 文档](https://www.paddleocr.ai/main/index.html)安装`paddleocr`



## 🚀 快速开始

### 1. 运行`main.py`

```Bash
python main.py
```

在命令提示行里输入图片的路径

**运行结果**： 程序将在控制台输出处理进度，并在图片同级目录下生成 `原文件名_result.jpg`，其中包含画出的字符框。



### 2. 打包为可执行文件 (package.py)

安装PyInstaller：

```bash
pip install pyinstaller
```

请确认当前准备环境中安装有待打包的Python脚本所需的全部依赖，以避免缺少依赖导致打包后的可执行程序出现异常。

使用提供的 `package.py` 脚本可以将项目打包为 exe 文件，该脚本会自动收集 PaddleX 和 PaddleOCR 所需的数据文件和二进制依赖。

**打包脚本支持的参数如下：**

| 参数     | 是否必需 | 说明                                                         |
| :------- | :------- | :----------------------------------------------------------- |
| --file   | 是       | 你的待打包文件名（如`main.py`）。                            |
| --nvidia | 否       | 将NVIDIA的CUDA、cuDNN相关依赖库一同打包到可执行文件的同级目录中。如果系统环境变量路径已包含CUDA、cuDNN相关依赖库或者不需要使用CUDA、cuDNN相关依赖库，则无需开启。 |

**打包脚本调用示例如下：**

```bash
python package.py --file main.py
# 将NVIDIA的CUDA、cuDNN相关依赖库打包至可执行文件的同级目录中。
python package.py --file main.py --nvidia
```



## 🧠 算法原理

代码中的 `get_char_boxes_from_crop` 函数实现了以下逻辑：

1. **图像预处理**：将裁剪出的文本行图像转换为灰度图，并进行 OTSU 二值化。

2. **垂直投影分析**：计算图像在垂直方向上的像素累加和。

3. **波谷检测**：寻找投影值为 0（或低于阈值）的区域作为字符分割线。

4. **策略判断**：
   - 如果分割出的段数 == OCR 识别的字符长度，则采用**投影分割结果**（适用于大部分打印字体）。
   
   - 如果数量不匹配（如存在字符粘连或断裂），则根据字符长度进行**等宽强制分割**。
   
     

## 📝 注意事项

+ OCR 版本：默认配置为 PP-OCRv5，如需更改可在 PaddleOCR 初始化参数中调整。



## 🤝 贡献

欢迎提交 Issue 或 Pull Request 来改进算法的准确度！

